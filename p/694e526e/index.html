<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>【Notes】LLM API+Agent+FastAPI+SSE+Docker | Rean's Blog</title><noscript>开启JavaScript才能访问本站哦~</noscript><link rel="icon" href="/img/favicon.png"><!-- index.css--><link rel="stylesheet" href="/css/index.css?v=1.8.10"><!-- inject head--><link rel="stylesheet" href="https://cdn2.codesign.qq.com/icons/7pOrz0WXB5ZWJPX/latest/iconfont.css"><!-- aplayer--><link rel="stylesheet" href="https://cdn.staticfile.net/aplayer/1.10.1/APlayer.min.css"><!-- swiper--><link rel="stylesheet" href="https://cdn.staticfile.net/Swiper/11.0.5/swiper-bundle.min.css"><!-- fancybox ui--><link rel="stylesheet" href="https://cdn.staticfile.net/fancyapps-ui/5.0.36/fancybox/fancybox.min.css"><!-- katex--><!-- Open Graph--><meta name="description" content="LLM APILLM API 请求体参数 n：默认1，每个prompt生成n个结果。 best_of：默认1，在服务器端生成best_of个完成结果，并返回 “最佳” 结果，结果无法流式传输。与n一起使用时，best_of控制候选完成结果的数量，而n指定要返回的数量（此时best_of必须大于n）。"><!-- pwa--><meta name="apple-mobile-web-app-capable" content="Rean's Blog"><meta name="theme-color" content="var(--efu-main)"><meta name="apple-mobile-web-app-status-bar-style" content="var(--efu-main)"><link rel="bookmark" href="/img/favicon.png"><link rel="apple-touch-icon" href="/img/favicon.png" sizes="180x180"><script>console.log(
    "%c Program: Hexo %c Theme: Solitude %c Version: v1.8.10",
    "border-radius:5px 0 0 5px;padding: 5px 10px;color:white;background:#ff3842;",
    "padding: 5px 10px;color:white;background:#3e9f50;",
    "padding: 5px 10px;color:white;background:#0084ff;",
)
</script><script>(()=>{
        const saveToLocal = {
            set: function setWithExpiry(key, value, ttl) {
                if (ttl === 0)
                    return
                const now = new Date()
                const expiryDay = ttl * 86400000
                const item = {
                    value: value,
                    expiry: now.getTime() + expiryDay
                }
                localStorage.setItem(key, JSON.stringify(item))
            },
            get: function getWithExpiry(key) {
                const itemStr = localStorage.getItem(key)
    
                if (!itemStr) {
                    return undefined
                }
                const item = JSON.parse(itemStr)
                const now = new Date()
    
                if (now.getTime() > item.expiry) {
                    localStorage.removeItem(key)
                    return undefined
                }
                return item.value
            }
        };
        window.utils = {
            saveToLocal: saveToLocal,
            getCSS: (url, id = false) => new Promise((resolve, reject) => {
              const link = document.createElement('link')
              link.rel = 'stylesheet'
              link.href = url
              if (id) link.id = id
              link.onerror = reject
              link.onload = link.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                link.onload = link.onreadystatechange = null
                resolve()
              }
              document.head.appendChild(link)
            }),
            getScript: (url, attr = {}) => new Promise((resolve, reject) => {
              const script = document.createElement('script')
              script.src = url
              script.async = true
              script.onerror = reject
              script.onload = script.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                script.onload = script.onreadystatechange = null
                resolve()
              }
    
              Object.keys(attr).forEach(key => {
                script.setAttribute(key, attr[key])
              })
    
              document.head.appendChild(script)
            }),
            addGlobalFn: (key, fn, name = false, parent = window) => {
                const globalFn = parent.globalFn || {}
                const keyObj = globalFn[key] || {}
        
                if (name && keyObj[name]) return
        
                name = name || Object.keys(keyObj).length
                keyObj[name] = fn
                globalFn[key] = keyObj
                parent.globalFn = globalFn
            },
        }
    })()</script><!-- global head--><script>const GLOBAL_CONFIG = {
    root: '/',
    algolia: undefined,
    localsearch: {"preload":false,"path":"/search.xml"},
    runtime: '2024-01-05 00:00:00',
    lazyload: {
        enable: true,
        error: '/img/error_load.png'
    },
    copyright: {"limit":50,"author":"作者: Rean","link":"链接: ","source":"来源: Rean's Blog","info":"著作权归作者所有。 商业转载请联系作者获得授权，非商业转载请注明出处。"},
    highlight: {
        enable: true,
        limit: 200,
        expand: true,
        copy: true,
        syntax: 'highlight.js'
    },
    randomlink: false,
    lang: {"theme":{"dark":"已切换至深色模式","light":"已切换至浅色模式"},"copy":{"success":"复制成功","error":"复制失败"},"backtop":"返回顶部","time":{"day":"天前","hour":"小时前","just":"刚刚","min":"分钟前","month":"个月前"},"f12":"开发者模式已打开，请遵循GPL协议。","totalk":"无需删除空行，直接输入评论即可","search":{"empty":"找不到你查询的内容：${query}","hit":"找到 ${hits} 条结果，用时 ${time} 毫秒","placeholder":"输入关键词快速查找","count":"共 <b>${count}</b> 条结果。"}},
    aside: {
        sayhello: {
            morning: '一日之计在于晨',
            noon: '吃饱了才有力气干活',
            afternoon: '集中精力，攻克难关',
            night: '不要太劳累了，早睡更健康',
            goodnight: '睡个好觉，保证精力充沛',
        },
        sayhello2: ["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🔨 设计开发一条龙","🎮 游戏爱好者"],
    },
    covercolor: {
        enable: true
    },
    comment: false,
    lightbox: 'fancybox',
    post_ai: false,
    right_menu: {"mode":{"dark":"深色模式","light":"浅色模式"},"img_error":"此图片无法复制与下载","music":{"start":"播放音乐","stop":"暂停音乐"},"translate":{"translateDelay":0,"defaultEncoding":2}},
};</script><!-- page-config head--><script id="config-diff">var PAGE_CONFIG = {
    is_post: true,
    is_page: false,
    is_home: false,
    page: '',
    toc: true,
    comment: false,
    ai_text: false,
}</script><meta name="generator" content="Hexo 7.2.0"></head><body id="body"><!-- universe--><canvas id="universe"></canvas><!-- loading--><!-- console--><div id="console"><div class="close-btn" onclick="sco.hideConsole()"><i class="solitude st-close-fill"></i></div><div class="button-group"><div class="console-btn-item"><span class="darkmode_switchbutton" onclick="sco.switchDarkMode()" title="昼夜切换"><i class="solitude st-moon-clear-fill"></i></span></div><div class="console-btn-item" id="consoleHideAside"><span class="asideSwitch" onclick="sco.switchHideAside()" title="边栏显示控制"><i class="solitude st-side-bar-fill"></i></span></div><div class="console-btn-item" id="consoleMusic" onclick="sco.musicToggle()"><span class="music-switch" title="音乐开关"><i class="solitude st-disc-fill"></i></span></div></div><div class="console-mask" onclick="sco.hideConsole()"></div></div><!-- sidebar--><div id="sidebar" style="zoom: 1;"><div id="menu-mask" style="display: none;"></div><div id="sidebar-menus"><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">182</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">160</div></a></div></div></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><span class="darkmode_switchbutton menu-child" onclick="sco.switchDarkMode()"><i class="solitude st-moon-clear-fill"></i><span>显示模式</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="solitude  st-folder-fill"></i><span>文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="solitude  st-checkbox-multiple-blank-fill"></i><span>分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="solitude  st-price-tag-fill"></i><span>标签</span></a></li><li><a class="site-page child" href="/study/"><i class="solitude  st-gift-fill"></i><span>学习</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="solitude  st-disc-fill"></i><span>音乐馆</span></a></li><li><a class="site-page child" href="/essay/"><span>即刻短文</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="solitude  st-contacts-fill"></i><span>关于本站</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-widget card-tags card-archives card-webinfo card-allinfo"><div class="card-tag-cloud"><a href="/tags/%E8%85%BE%E8%AE%AF/">腾讯<sup>1</sup></a><a href="/tags/%E5%90%8E%E5%8F%B0%E5%BC%80%E5%8F%91/">后台开发<sup>1</sup></a><a href="/tags/Markdown/">Markdown<sup>1</sup></a><a href="/tags/Butterfly/">Butterfly<sup>2</sup></a><a href="/tags/PyCharm/">PyCharm<sup>1</sup></a><a href="/tags/IDEA/">IDEA<sup>1</sup></a><a href="/tags/Git/">Git<sup>2</sup></a><a href="/tags/Halo/">Halo<sup>1</sup></a><a href="/tags/GitHub/">GitHub<sup>1</sup></a><a href="/tags/JavaFx/">JavaFx<sup>2</sup></a><a href="/tags/SpringBoot/">SpringBoot<sup>7</sup></a><a href="/tags/Java/">Java<sup>18</sup></a><a href="/tags/MyBatis/">MyBatis<sup>4</sup></a><a href="/tags/Hexo/">Hexo<sup>3</sup></a><a href="/tags/SyncTV/">SyncTV<sup>1</sup></a><a href="/tags/AList/">AList<sup>1</sup></a><a href="/tags/%E5%AE%9D%E5%A1%94/">宝塔<sup>3</sup></a><a href="/tags/Vue/">Vue<sup>18</sup></a><a href="/tags/Vite/">Vite<sup>6</sup></a><a href="/tags/JavaScript/">JavaScript<sup>4</sup></a><a href="/tags/TypeScript/">TypeScript<sup>3</sup></a><a href="/tags/Electron/">Electron<sup>4</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习<sup>1</sup></a><a href="/tags/scikit-learn/">scikit-learn<sup>1</sup></a><a href="/tags/vocalremover/">vocalremover<sup>1</sup></a><a href="/tags/BPM/">BPM<sup>1</sup></a><a href="/tags/%E9%BB%91%E7%A5%9E%E8%AF%9D%EF%BC%9A%E6%82%9F%E7%A9%BA/">黑神话：悟空<sup>1</sup></a><a href="/tags/HTTP/">HTTP<sup>5</sup></a><a href="/tags/HTTPS/">HTTPS<sup>2</sup></a><a href="/tags/%E7%9F%AD%E9%93%BE/">短链<sup>1</sup></a><a href="/tags/%E8%A7%86%E9%A2%91/">视频<sup>1</sup></a><a href="/tags/HTTP-1-1/">HTTP/1.1<sup>1</sup></a><a href="/tags/LaTex/">LaTex<sup>1</sup></a><a href="/tags/%E5%8A%A0%E5%AF%86/">加密<sup>1</sup></a><a href="/tags/IP/">IP<sup>2</sup></a><a href="/tags/ICMP/">ICMP<sup>1</sup></a><a href="/tags/I-O/">I/O<sup>2</sup></a><a href="/tags/JVM/">JVM<sup>2</sup></a><a href="/tags/Springboot/">Springboot<sup>1</sup></a><a href="/tags/ThreadLocal/">ThreadLocal<sup>1</sup></a><a href="/tags/UUID/">UUID<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/">并发<sup>4</sup></a><a href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/">红黑树<sup>2</sup></a><a href="/tags/%E9%93%BE%E8%A1%A8/">链表<sup>1</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3/">力扣<sup>1</sup></a><a href="/tags/LeetCode/">LeetCode<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库<sup>8</sup></a><a href="/tags/NLP/">NLP<sup>6</sup></a><a href="/tags/spaCy/">spaCy<sup>4</sup></a><a href="/tags/Python/">Python<sup>1</sup></a><a href="/tags/Redis/">Redis<sup>10</sup></a><a href="/tags/RDB/">RDB<sup>1</sup></a><a href="/tags/AOF/">AOF<sup>1</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/">线程<sup>2</sup></a><a href="/tags/I-O%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/">I/O多路复用<sup>2</sup></a><a href="/tags/Spring/">Spring<sup>5</sup></a><a href="/tags/TCP/">TCP<sup>7</sup></a><a href="/tags/UDP/">UDP<sup>1</sup></a><a href="/tags/Socket/">Socket<sup>1</sup></a><a href="/tags/FFMpeg/">FFMpeg<sup>1</sup></a><a href="/tags/%E6%A0%B7%E5%BC%8F/">样式<sup>1</sup></a><a href="/tags/ECMAScript/">ECMAScript<sup>2</sup></a><a href="/tags/Element/">Element<sup>3</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">分布式锁<sup>1</sup></a><a href="/tags/%E5%91%A8%E6%B7%B1/">周深<sup>7</sup></a><a href="/tags/%E5%BE%B5%E7%BE%BD%E6%91%A9%E6%9F%AF/">徵羽摩柯<sup>1</sup></a><a href="/tags/%E9%9F%B3%E4%B9%90%E7%BC%98%E8%AE%A1%E5%88%92/">音乐缘计划<sup>4</sup></a><a href="/tags/%E5%A5%A5%E6%96%AF%E5%8D%A1/">奥斯卡<sup>3</sup></a><a href="/tags/%E5%BC%A0%E6%9D%B0/">张杰<sup>2</sup></a><a href="/tags/%E5%A3%B0%E7%94%9F%E4%B8%8D%E6%81%AF%C2%B7%E5%AE%9D%E5%B2%9B%E5%AD%A3/">声生不息·宝岛季<sup>3</sup></a><a href="/tags/%E5%BE%90%E4%BD%B3%E8%8E%B9/">徐佳莹<sup>1</sup></a><a href="/tags/SynthV/">SynthV<sup>22</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统<sup>4</sup></a><a href="/tags/%E6%B0%B8%E5%A4%9CMinus/">永夜Minus<sup>6</sup></a><a href="/tags/%E9%9F%A6%E7%A4%BC%E5%AE%89/">韦礼安<sup>1</sup></a><a href="/tags/%E8%94%A1%E4%BE%9D%E6%9E%97/">蔡依林<sup>1</sup></a><a href="/tags/%E6%97%A0%E5%8F%82/">无参<sup>46</sup></a><a href="/tags/%E5%8F%A4%E9%A3%8E/">古风<sup>12</sup></a><a href="/tags/%E4%B8%89%E6%97%A0Marblue/">三无Marblue<sup>1</sup></a><a href="/tags/%E7%B4%A2%E5%BC%95/">索引<sup>1</sup></a><a href="/tags/B%E6%A0%91/">B树<sup>1</sup></a><a href="/tags/B-%E6%A0%91/">B+树<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构<sup>1</sup></a><a href="/tags/%E6%A0%91/">树<sup>1</sup></a><a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/">二叉树<sup>1</sup></a><a href="/tags/%E8%AE%B8%E9%92%A7/">许钧<sup>1</sup></a><a href="/tags/%E6%AD%8C%E6%89%8B2024/">歌手2024<sup>37</sup></a><a href="/tags/Chante-Moore/">Chanté Moore<sup>2</sup></a><a href="/tags/%E9%BB%84%E5%AE%A3/">黄宣<sup>1</sup></a><a href="/tags/Faouzia/">Faouzia<sup>4</sup></a><a href="/tags/Lenka/">Lenka<sup>1</sup></a><a href="/tags/%E5%BC%A0%E9%92%B0%E7%90%AA/">张钰琪<sup>1</sup></a><a href="/tags/%E9%82%A3%E8%8B%B1/">那英<sup>9</sup></a><a href="/tags/%E5%B0%A4%E9%95%BF%E9%9D%96/">尤长靖<sup>2</sup></a><a href="/tags/%E5%AD%99%E6%A5%A0/">孙楠<sup>5</sup></a><a href="/tags/%E8%B0%AD%E7%BB%B4%E7%BB%B4/">谭维维<sup>3</sup></a><a href="/tags/%E5%B4%A9%E5%9D%8F%EF%BC%9A%E6%98%9F%E7%A9%B9%E9%93%81%E9%81%93/">崩坏：星穹铁道<sup>4</sup></a><a href="/tags/%E8%B5%A4%E7%BE%BD/">赤羽<sup>1</sup></a><a href="/tags/%E6%B1%AA%E8%8B%8F%E6%B3%B7/">汪苏泷<sup>4</sup></a><a href="/tags/%E5%A3%B0%E7%94%9F%E4%B8%8D%E6%81%AF%C2%B7%E5%AE%B6%E5%B9%B4%E5%8D%8E/">声生不息·家年华<sup>3</sup></a><a href="/tags/%E9%99%88%E6%A5%9A%E7%94%9F/">陈楚生<sup>3</sup></a><a href="/tags/%E9%99%88%E4%BA%A6%E6%B4%BA/">陈亦洺<sup>1</sup></a><a href="/tags/%E5%B0%9A%E8%BE%B0/">尚辰<sup>1</sup></a><a href="/tags/%E5%BF%98%E5%B7%9D%E9%A3%8E%E5%8D%8E%E5%BD%95/">忘川风华录<sup>2</sup></a><a href="/tags/%E4%B9%90%E6%AD%A3%E9%BE%99%E7%89%99/">乐正龙牙<sup>1</sup></a><a href="/tags/%E6%98%9F%E5%B0%98Infinity/">星尘Infinity<sup>4</sup></a><a href="/tags/%E6%98%8E%E6%97%A5%E6%96%B9%E8%88%9F/">明日方舟<sup>3</sup></a><a href="/tags/%E7%A5%96%E5%A8%85%E7%BA%B3%E6%83%9C/">祖娅纳惜<sup>1</sup></a><a href="/tags/%E7%94%B5%E5%AD%90/">电子<sup>1</sup></a><a href="/tags/%E6%98%9F%E5%B0%98/">星尘<sup>6</sup></a><a href="/tags/%E5%BC%A0%E4%BF%A1%E5%93%B2/">张信哲<sup>2</sup></a><a href="/tags/%E9%93%B6%E4%B8%B4/">银临<sup>1</sup></a><a href="/tags/%E6%9D%8E%E5%B8%B8%E8%B6%85/">李常超<sup>1</sup></a><a href="/tags/%E5%B1%B1%E8%89%B2%E6%9C%89%E6%97%A0%E4%B8%AD/">山色有无中<sup>1</sup></a><a href="/tags/%E5%91%A8%E6%9D%B0%E4%BC%A6/">周杰伦<sup>1</sup></a><a href="/tags/%E9%BB%84%E9%9C%84%E9%9B%B2/">黄霄雲<sup>1</sup></a><a href="/tags/%E5%AE%B9%E7%A5%96%E5%84%BF/">容祖儿<sup>1</sup></a><a href="/tags/%E6%88%91%E6%98%AF%E6%AD%8C%E6%89%8B%C2%B7%E7%AC%AC%E5%9B%9B%E5%AD%A3/">我是歌手·第四季<sup>1</sup></a><a href="/tags/%E6%9D%8E%E5%85%8B%E5%8B%A4/">李克勤<sup>1</sup></a><a href="/tags/%E7%B2%A4%E8%AF%AD/">粤语<sup>2</sup></a><a href="/tags/%E9%BB%84%E4%B8%BD%E7%8E%B2/">黄丽玲<sup>1</sup></a><a href="/tags/G-E-M-%E9%82%93%E7%B4%AB%E6%A3%8B/">G.E.M.邓紫棋<sup>7</sup></a><a href="/tags/T-I-M-E/">T.I.M.E.<sup>4</sup></a><a href="/tags/%E6%97%B6%E5%85%89%E9%9F%B3%E4%B9%90%E4%BC%9A%C2%B7%E8%80%81%E5%8F%8B%E8%AE%B0/">时光音乐会·老友记<sup>5</sup></a><a href="/tags/%E5%BC%A0%E5%AD%A6%E5%8F%8B/">张学友<sup>1</sup></a><a href="/tags/%E6%9D%A8%E4%B8%9E%E7%90%B3/">杨丞琳<sup>1</sup></a><a href="/tags/%E6%B1%AA%E5%B3%B0/">汪峰<sup>1</sup></a><a href="/tags/%E6%9C%AA%E5%AE%9A%E4%BA%8B%E4%BB%B6%E7%B0%BF/">未定事件簿<sup>1</sup></a><a href="/tags/%E5%BC%A0%E8%BF%9C/">张远<sup>1</sup></a><a href="/tags/%E5%AD%99%E7%87%95%E5%A7%BF/">孙燕姿<sup>2</sup></a><a href="/tags/%E6%B5%B7%E6%9D%A5%E9%98%BF%E6%9C%A8/">海来阿木<sup>1</sup></a><a href="/tags/%E6%9B%B9%E6%9D%A8/">曹杨<sup>3</sup></a><a href="/tags/%E4%B8%8B%E4%B8%80%E6%88%98%E6%AD%8C%E6%89%8B/">下一战歌手<sup>3</sup></a><a href="/tags/Fine%E4%B9%90%E5%9B%A2/">Fine乐团<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络<sup>4</sup></a><a href="/tags/DNS/">DNS<sup>1</sup></a><a href="/tags/MAC/">MAC<sup>1</sup></a><a href="/tags/Adam-Lambert/">Adam Lambert<sup>1</sup></a><a href="/tags/%E4%BA%9A%E5%BD%93%C2%B7%E5%85%B0%E4%BC%AF%E7%89%B9/">亚当·兰伯特<sup>1</sup></a><a href="/tags/Hayden/">Hayden<sup>1</sup></a><a href="/tags/%E6%9A%AE%E5%A4%9C/">暮夜<sup>1</sup></a><a href="/tags/ACE-Studio/">ACE Studio<sup>3</sup></a><a href="/tags/%E5%B0%9A%E9%9B%AF%E5%A9%95/">尚雯婕<sup>1</sup></a><a href="/tags/%E4%B8%9C%E6%96%B9%E6%A0%80%E5%AD%90/">东方栀子<sup>2</sup></a><a href="/tags/%E9%BB%84%E7%BB%AE%E7%8F%8A/">黄绮珊<sup>1</sup></a><a href="/tags/%E5%8D%8E%E6%99%A8%E5%AE%87/">华晨宇<sup>1</sup></a><a href="/tags/JUN/">JUN<sup>1</sup></a><a href="/tags/%E6%9E%97%E5%BF%86%E8%8E%B2/">林忆莲<sup>1</sup></a><a href="/tags/UTAU/">UTAU<sup>1</sup></a><a href="/tags/Sheena/">Sheena<sup>1</sup></a><a href="/tags/%E5%89%A7%E5%A5%BD%E5%90%AC%E7%9A%84%E6%AD%8C/">剧好听的歌<sup>1</sup></a><a href="/tags/Syncthing/">Syncthing<sup>1</sup></a><a href="/tags/%E5%90%8C%E6%AD%A5/">同步<sup>1</sup></a><a href="/tags/%E6%94%AF%E4%BB%98%E5%AE%9D/">支付宝<sup>1</sup></a><a href="/tags/Apifox/">Apifox<sup>2</sup></a><a href="/tags/%E5%B2%B8%E6%99%93/">岸晓<sup>1</sup></a><a href="/tags/%E5%8D%95%E4%BE%9D%E7%BA%AF/">单依纯<sup>2</sup></a><a href="/tags/%E9%BB%84%E5%AD%90%E5%BC%98%E5%87%A1/">黄子弘凡<sup>1</sup></a><a href="/tags/%E5%A2%A8%E6%B8%85%E5%BC%A6/">墨清弦<sup>1</sup></a><a href="/tags/%E6%AD%8C%E6%89%8B2025/">歌手2025<sup>1</sup></a></div></div></div></div><!-- keyboard--><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav class="show" id="nav"><div id="nav-group"><div id="blog_name"><a id="site-name" href="/" title="返回博客主页"><span class="title">Rean's Blog</span></a></div><div id="page-name-mask"><div id="page-name"><a id="page-name-text" onclick="sco.toTop()">【Notes】LLM API+Agent+FastAPI+SSE+Docker</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="solitude  st-folder-fill"></i><span>文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="solitude  st-checkbox-multiple-blank-fill"></i><span>分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="solitude  st-price-tag-fill"></i><span>标签</span></a></li><li><a class="site-page child" href="/study/"><i class="solitude  st-gift-fill"></i><span>学习</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="solitude  st-disc-fill"></i><span>音乐馆</span></a></li><li><a class="site-page child" href="/essay/"><span>即刻短文</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="solitude  st-contacts-fill"></i><span>关于本站</span></a></li></ul></div></div></div><div id="nav-left"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机一篇文章" href="javascript:void(0);"><i class="solitude st-signal-tower-fill"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索"><i class="solitude st-search-line"></i></a></div><div class="nav-button" id="nav-console"><a class="console_switchbutton" onclick="sco.showConsole()" title="中控台" href="javascript:void(0);"><i class="solitude st-dashboard-fill"></i></a></div><div class="nav-button" id="nav-totop" onclick="sco.toTop()"><a class="totopbtn"><i class="solitude st-arrow-up-line"></i><span id="percent">0</span></a></div><div id="toggle-menu"><a class="site-page"><i class="solitude st-menu-line"></i></a></div></div></div></nav><div class="coverdiv" id="coverdiv"><img class="nolazyload" id="post-cover" src="https://npm.elemecdn.com/justlovesmile-photo/cover8.JPG" alt="【Notes】LLM API+Agent+FastAPI+SSE+Docker"></div><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original" title="该文章为原创文章，注意版权协议">原创</a><span class="post-meta-categories"><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span><div class="tag_share"><div class="post-meta__tag-list"></div></div></div></div><h1 class="post-title">【Notes】LLM API+Agent+FastAPI+SSE+Docker</h1><div id="post-meta"><div class="meta-secondline"><span class="post-meta-date" title="发布于 2025-07-21 10:49:51"><i class="post-meta-icon solitude st-calendar-todo-fill"></i><time datetime="2025-07-21T02:49:51.000Z">2025-07-21T02:49:51.000Z</time></span><span class="post-meta-date" title="最后更新于 2025-07-24 11:17:26"><i class="post-meta-icon solitude st-refresh-line"></i><time datetime="2025-07-24T03:17:26.312Z">2025-07-24T03:17:26.312Z</time></span><span class="post-meta-wordcount"><i class="post-meta-icon solitude st-word-fill" title="文章字数"></i><span class="word-count">6.7k</span><span class="post-meta-separator"></span><i class="post-meta-icon solitude st-clock-fill" title="阅读耗时"></i><span>32 min</span></span><a class="post-meta-pv" href="/p/694e526e/" title="文章热度"><i class="post-meta-icon solitude st-fire-fill"></i><span id="busuanzi_page_pv"><i class="solitude st-loading-line"></i></span></a></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="LLM-API"><a href="#LLM-API" class="headerlink" title="LLM API"></a>LLM API</h1><h2 id="LLM-API-请求体参数"><a href="#LLM-API-请求体参数" class="headerlink" title="LLM API 请求体参数"></a>LLM API 请求体参数</h2><ul>
<li><code>n</code>：默认1，每个prompt生成<code>n</code>个结果。</li>
<li><code>best_of</code>：默认1，在服务器端生成<code>best_of</code>个完成结果，并返回 “最佳” 结果，结果无法流式传输。与<code>n</code>一起使用时，<code>best_of</code>控制候选完成结果的数量，而<code>n</code>指定要返回的数量（此时<code>best_of</code>必须大于<code>n</code>）。</li>
<li><code>logit_bias</code>：修改指定token出现在完成结果中的可能性。接受一个JSON对象，将token（通过token ID指定）映射到 -100 到 100 之间的相关偏差值。 -1 到 1 之间的值应该会降低或增加选择的可能性； -100 或 100 这样的值应该会导致相关token被禁止出现或被唯一选择。 例如，传入<code>&#123;&quot;50256&quot;: -100&#125;</code>可以防止生成<code>&lt;|endoftext|&gt;</code>的token。</li>
<li><code>logprobs</code>：最大值5，输出<code>logprobs</code>个最有可能的 token 及其对应概率，例如<code>logprobs</code>为 5，API 将返回 5 个最有可能的词元的列表。</li>
<li><code>frequency_penalty</code>：对新 token 出现频率的惩罚值，范围<code>[-2.0, 2.0]</code>。值 &gt; 0 鼓励模型使用新 token，而值 &lt; 0 鼓励模型重复 token。</li>
<li><code>presence_penalty</code>：是否出现新 token 的惩罚值，范围<code>[-2.0, 2.0]</code>。值 &gt; 0 鼓励模型使用新 token，值 &lt; 0 鼓励模型重复 token。</li>
<li><code>seed</code>：用于生成的随机种子。</li>
<li><code>suffix</code>：用于在生成的文本后添加一段固定的后缀。</li>
<li><code>temperature</code>：默认1，控制采样随机性的浮点数，范围<code>[0, 2]</code>。较低的值使模型更具确定性，较高的值使模型更具随机性。值为 0 表示贪婪采样。</li>
<li><code>top_p</code>：默认1，核采样，模型会考虑概率质量在前 <code>top_p</code> 的 token 的结果。例如，0.1 意味着只考虑概率质量在前 10% 的 token。</li>
</ul>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line">client = OpenAI(</span><br><span class="line">        base_url=os.getenv(<span class="string">&quot;BAILIAN_API_BASE_URL&quot;</span>),</span><br><span class="line">        api_key=os.getenv(<span class="string">&quot;BAILIAN_API_KEY&quot;</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">        model=model,</span><br><span class="line">        messages=prompt,</span><br><span class="line">        max_tokens=<span class="number">500</span>,</span><br><span class="line">        temperature=<span class="number">0.7</span>,</span><br><span class="line">        stop=[<span class="string">&quot;用户：&quot;</span>],  <span class="comment"># 防止模型生成用户的发言</span></span><br><span class="line">        extra_body=&#123;<span class="string">&quot;enable_thinking&quot;</span>: <span class="literal">False</span>&#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>



<h2 id="结构化输出"><a href="#结构化输出" class="headerlink" title="结构化输出"></a>结构化输出</h2><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li><p>定义Json Schema</p>
</li>
<li><p>指定<code>text.format</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">text: &#123; <span class="built_in">format</span>: &#123; <span class="built_in">type</span>: <span class="string">&quot;json_schema&quot;</span>, <span class="string">&quot;strict&quot;</span>: true, <span class="string">&quot;schema&quot;</span>: … &#125; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>处理边界情况</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = client.responses.create(</span><br><span class="line">    model=<span class="string">&quot;gpt-4o-2024-08-06&quot;</span>,</span><br><span class="line">    <span class="built_in">input</span>=[</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are a helpful math tutor. Guide the user through the solution step by step.&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;how can I solve 8x + 7 = -23&quot;</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">    text=&#123;</span><br><span class="line">        <span class="string">&quot;format&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;json_schema&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;math_response&quot;</span>,</span><br><span class="line">            <span class="string">&quot;schema&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">                <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;steps&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;array&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;items&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;explanation&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;,</span><br><span class="line">                                <span class="string">&quot;output&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;explanation&quot;</span>, <span class="string">&quot;output&quot;</span>],</span><br><span class="line">                            <span class="string">&quot;additionalProperties&quot;</span>: <span class="literal">False</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;final_answer&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;steps&quot;</span>, <span class="string">&quot;final_answer&quot;</span>],</span><br><span class="line">                <span class="string">&quot;additionalProperties&quot;</span>: <span class="literal">False</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;strict&quot;</span>: <span class="literal">True</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.output_text)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="支持的-Schema"><a href="#支持的-Schema" class="headerlink" title="支持的 Schema"></a>支持的 Schema</h3><ul>
<li>String</li>
<li>Number</li>
<li>Boolean</li>
<li>Integer</li>
<li>Object</li>
<li>Array</li>
<li>Enum</li>
<li>anyOf</li>
</ul>
<h4 id="支持的属性"><a href="#支持的属性" class="headerlink" title="支持的属性"></a>支持的属性</h4><h5 id="string"><a href="#string" class="headerlink" title="string"></a>string</h5><ul>
<li><p><code>pattern</code>：正则表达式</p>
</li>
<li><p><code>format</code>：预定义的格式</p>
<ul>
<li><code>date-time</code></li>
<li><code>time</code></li>
<li><code>date</code></li>
<li><code>duration</code></li>
<li><code>email</code></li>
<li><code>hostname</code></li>
<li><code>ipv4</code></li>
<li><code>ipv6</code></li>
<li><code>uuid</code></li>
</ul>
</li>
</ul>
<h5 id="number"><a href="#number" class="headerlink" title="number"></a>number</h5><ul>
<li><code>multipleOf</code>：必须是该数的倍数</li>
<li><code>maximum</code>：&lt;&#x3D;</li>
<li><code>exclusiveMaximum</code>：&lt;</li>
<li><code>minimum</code>：&gt;&#x3D;</li>
<li><code>exclusiveMinimum</code>：&gt;</li>
</ul>
<h5 id="array"><a href="#array" class="headerlink" title="array"></a>array</h5><ul>
<li><code>minItems</code></li>
<li><code>maxItems</code></li>
</ul>
<h3 id="Json-模式"><a href="#Json-模式" class="headerlink" title="Json 模式"></a>Json 模式</h3><p>将<code>text.format</code>设置为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;json_object&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>使用函数调用时，JSON 模式将始终开启。</p>
<p>使用 JSON 模式时，必须始终通过对话中的某些消息（例如通过系统消息）指示模型生成 JSON，否则可能会生成无休止的空白字符流。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = client.responses.create(</span><br><span class="line">        model=<span class="string">&quot;gpt-3.5-turbo-0125&quot;</span>,</span><br><span class="line">        <span class="built_in">input</span>=[</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are a helpful assistant designed to output JSON.&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Who won the world series in 2020? Please respond in the format &#123;winner: ...&#125;&quot;</span>&#125;</span><br><span class="line">        ],</span><br><span class="line">        text=&#123;<span class="string">&quot;format&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;json_object&quot;</span>&#125;&#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h2 id="使用-Tools"><a href="#使用-Tools" class="headerlink" title="使用 Tools"></a>使用 Tools</h2><p>在生成模型回复时，可以使用内置的 Tools 来扩展模型的能力，帮助模型从网络或文件中获取更多上下文和信息。</p>
<p>例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line">client = OpenAI()</span><br><span class="line"></span><br><span class="line">response = client.responses.create(</span><br><span class="line">    model=<span class="string">&quot;gpt-4.1&quot;</span>,</span><br><span class="line">    tools=[&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;web_search_preview&quot;</span>&#125;],</span><br><span class="line">    <span class="built_in">input</span>=<span class="string">&quot;What was a positive news story from today?&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.output_text)</span><br></pre></td></tr></table></figure>

<h3 id="可用的-Tools"><a href="#可用的-Tools" class="headerlink" title="可用的 Tools"></a>可用的 Tools</h3><ul>
<li>函数调用</li>
<li>网络搜索</li>
<li>远程 MCP(Model Context Protocol) 服务</li>
<li>文件搜索</li>
<li>图片生成</li>
<li>代码解释</li>
<li>计算机使用：在计算机上进行各种操作和任务</li>
</ul>
<h2 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h2><h3 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h3><p>函数可以在每个 API 请求的<code>tools</code>参数中设置。</p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>type</code></td>
<td align="left">必须为 <code>function</code></td>
</tr>
<tr>
<td align="left"><code>name</code></td>
<td align="left">函数名称 (e.g. <code>get_weather</code>)</td>
</tr>
<tr>
<td align="left"><code>description</code></td>
<td align="left">何时、如何使用函数的细节</td>
</tr>
<tr>
<td align="left"><code>parameters</code></td>
<td align="left">定义函数输入参数的<a target="_blank" rel="noopener" href="https://json-schema.org/">JSON schema</a></td>
</tr>
<tr>
<td align="left"><code>strict</code></td>
<td align="left">是否对函数调用强制执行严格模式</td>
</tr>
</tbody></table>
<p>例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;get_weather&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Retrieves current weather for the given location.&quot;</span>,</span><br><span class="line">  <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;City and country e.g. Bogotá, Colombia&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;units&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="string">&quot;enum&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;celsius&quot;</span>,</span><br><span class="line">          <span class="string">&quot;fahrenheit&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Units the temperature will be returned in.&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;required&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;location&quot;</span>,</span><br><span class="line">      <span class="string">&quot;units&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;additionalProperties&quot;</span>: false</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;strict&quot;</span>: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="流式响应"><a href="#流式响应" class="headerlink" title="流式响应"></a>流式响应</h2><p>流式响应允许在模型继续生成完整响应的同时，开始打印或处理模型输出的开头部分。</p>
<p>设置<code>stream=True</code>即可使用：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line">client = OpenAI()</span><br><span class="line"></span><br><span class="line">stream = client.responses.create(</span><br><span class="line">    model=<span class="string">&quot;gpt-4.1&quot;</span>,</span><br><span class="line">    <span class="built_in">input</span>=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Say &#x27;double bubble bath&#x27; ten times fast.&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">    stream=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> stream:</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br></pre></td></tr></table></figure>

<p>Responses API 使用语义事件进行流式传输，每个事件都按照预定义的模式进行类型标注。完整的事件类型列表，请参阅<a target="_blank" rel="noopener" href="https://platform.openai.com/docs/api-reference/responses-streaming">流式传输的 API 参考文档</a>。</p>
<h1 id="Agent-Agno"><a href="#Agent-Agno" class="headerlink" title="Agent - Agno"></a>Agent - Agno</h1><h2 id="Agent-创建"><a href="#Agent-创建" class="headerlink" title="Agent 创建"></a>Agent 创建</h2><p>简单Agent：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"><span class="keyword">from</span> agno.models.anthropic <span class="keyword">import</span> Claude</span><br><span class="line"><span class="keyword">from</span> agno.tools.yfinance <span class="keyword">import</span> YFinanceTools</span><br><span class="line"></span><br><span class="line">agent = Agent(</span><br><span class="line">    model=Claude(<span class="built_in">id</span>=<span class="string">&quot;claude-sonnet-4-20250514&quot;</span>),</span><br><span class="line">    tools=[YFinanceTools(stock_price=<span class="literal">True</span>)],</span><br><span class="line">    instructions=<span class="string">&quot;Use tables to display data. Don&#x27;t include any other text.&quot;</span>,</span><br><span class="line">    markdown=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">agent.print_response(<span class="string">&quot;What is the stock price of Apple?&quot;</span>, stream=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="OpenAI-Like-模型"><a href="#OpenAI-Like-模型" class="headerlink" title="OpenAI Like 模型"></a>OpenAI Like 模型</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getenv</span><br><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent, RunResponse</span><br><span class="line"><span class="keyword">from</span> agno.models.openai.like <span class="keyword">import</span> OpenAILike</span><br><span class="line"></span><br><span class="line">agent = Agent(</span><br><span class="line">    model=OpenAILike(</span><br><span class="line">        <span class="built_in">id</span>=<span class="string">&quot;mistralai/Mixtral-8x7B-Instruct-v0.1&quot;</span>,</span><br><span class="line">        api_key=getenv(<span class="string">&quot;TOGETHER_API_KEY&quot;</span>),</span><br><span class="line">        base_url=<span class="string">&quot;https://api.together.xyz/v1&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the response in the terminal</span></span><br><span class="line">agent.print_response(<span class="string">&quot;Share a 2 sentence horror story.&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="运行-Agent"><a href="#运行-Agent" class="headerlink" title="运行 Agent"></a>运行 Agent</h3><p>从 <code>agno 1.6.0</code> 开始，<code>run()</code>将返回 <code>RunResponseEvent</code> 的迭代对象。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Iterator</span><br><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent, RunResponseEvent</span><br><span class="line"><span class="keyword">from</span> agno.models.openai <span class="keyword">import</span> OpenAIChat</span><br><span class="line"><span class="keyword">from</span> agno.utils.pprint <span class="keyword">import</span> pprint_run_response</span><br><span class="line"></span><br><span class="line">agent = Agent(model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4-mini&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run agent and return the response as a stream</span></span><br><span class="line">response_stream: Iterator[RunResponseEvent] = agent.run(</span><br><span class="line">    <span class="string">&quot;Tell me a 5 second short story about a lion&quot;</span>,</span><br><span class="line">    stream=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the response stream in markdown format</span></span><br><span class="line">pprint_run_response(response_stream, markdown=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Agent-State"><a href="#Agent-State" class="headerlink" title="Agent State"></a>Agent State</h2><p>Agno 提供了状态管理系统，只需添加变量到 <code>session_state</code>，以及设置<code>add_state_in_messages=True</code>。</p>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"><span class="keyword">from</span> agno.models.openai <span class="keyword">import</span> OpenAIChat</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a tool that adds an item to the shopping list</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">agent: Agent, item: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add an item to the shopping list.&quot;&quot;&quot;</span></span><br><span class="line">    agent.session_state[<span class="string">&quot;shopping_list&quot;</span>].append(item)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;The shopping list is now <span class="subst">&#123;agent.session_state[<span class="string">&#x27;shopping_list&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an Agent that maintains state</span></span><br><span class="line">agent = Agent(</span><br><span class="line">    model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4o-mini&quot;</span>),</span><br><span class="line">    <span class="comment"># Initialize the session state with a counter starting at 0</span></span><br><span class="line">    session_state=&#123;<span class="string">&quot;shopping_list&quot;</span>: []&#125;,</span><br><span class="line">    tools=[add_item],</span><br><span class="line">    <span class="comment"># You can use variables from the session state in the instructions</span></span><br><span class="line">    instructions=<span class="string">&quot;Current state (shopping list) is: &#123;shopping_list&#125;&quot;</span>,</span><br><span class="line">    <span class="comment"># Important: Add the state to the messages</span></span><br><span class="line">    add_state_in_messages=<span class="literal">True</span>,</span><br><span class="line">    markdown=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">agent.print_response(<span class="string">&quot;Add milk, eggs, and bread to the shopping list&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Final session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="跨对话保持状态"><a href="#跨对话保持状态" class="headerlink" title="跨对话保持状态"></a>跨对话保持状态</h3><p>示例：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> textwrap <span class="keyword">import</span> dedent</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"><span class="keyword">from</span> agno.models.openai <span class="keyword">import</span> OpenAIChat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define tools to manage our shopping list</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">agent: Agent, item: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add an item to the shopping list and return confirmation.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Add the item if it&#x27;s not already in the list</span></span><br><span class="line">    <span class="keyword">if</span> item.lower() <span class="keyword">not</span> <span class="keyword">in</span> [i.lower() <span class="keyword">for</span> i <span class="keyword">in</span> agent.session_state[<span class="string">&quot;shopping_list&quot;</span>]]:</span><br><span class="line">        agent.session_state[<span class="string">&quot;shopping_list&quot;</span>].append(item)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Added &#x27;<span class="subst">&#123;item&#125;</span>&#x27; to the shopping list&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;&#x27;<span class="subst">&#123;item&#125;</span>&#x27; is already in the shopping list&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_item</span>(<span class="params">agent: Agent, item: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Remove an item from the shopping list by name.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Case-insensitive search</span></span><br><span class="line">    <span class="keyword">for</span> i, list_item <span class="keyword">in</span> <span class="built_in">enumerate</span>(agent.session_state[<span class="string">&quot;shopping_list&quot;</span>]):</span><br><span class="line">        <span class="keyword">if</span> list_item.lower() == item.lower():</span><br><span class="line">            agent.session_state[<span class="string">&quot;shopping_list&quot;</span>].pop(i)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Removed &#x27;<span class="subst">&#123;list_item&#125;</span>&#x27; from the shopping list&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;&#x27;<span class="subst">&#123;item&#125;</span>&#x27; was not found in the shopping list&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_items</span>(<span class="params">agent: Agent</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;List all items in the shopping list.&quot;&quot;&quot;</span></span><br><span class="line">    shopping_list = agent.session_state[<span class="string">&quot;shopping_list&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> shopping_list:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The shopping list is empty.&quot;</span></span><br><span class="line"></span><br><span class="line">    items_text = <span class="string">&quot;\n&quot;</span>.join([<span class="string">f&quot;- <span class="subst">&#123;item&#125;</span>&quot;</span> <span class="keyword">for</span> item <span class="keyword">in</span> shopping_list])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Current shopping list:\n<span class="subst">&#123;items_text&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a Shopping List Manager Agent that maintains state</span></span><br><span class="line">agent = Agent(</span><br><span class="line">    model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4o-mini&quot;</span>),</span><br><span class="line">    <span class="comment"># Initialize the session state with an empty shopping list</span></span><br><span class="line">    session_state=&#123;<span class="string">&quot;shopping_list&quot;</span>: []&#125;,</span><br><span class="line">    tools=[add_item, remove_item, list_items],</span><br><span class="line">    <span class="comment"># You can use variables from the session state in the instructions</span></span><br><span class="line">    instructions=dedent(<span class="string">&quot;&quot;&quot;\</span></span><br><span class="line"><span class="string">        Your job is to manage a shopping list.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The shopping list starts empty. You can add items, remove items by name, and list all items.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Current shopping list: &#123;shopping_list&#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>),</span><br><span class="line">    show_tool_calls=<span class="literal">True</span>,</span><br><span class="line">    add_state_in_messages=<span class="literal">True</span>,</span><br><span class="line">    markdown=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">agent.print_response(<span class="string">&quot;Add milk, eggs, and bread to the shopping list&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent.print_response(<span class="string">&quot;I got bread&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent.print_response(<span class="string">&quot;I need apples and oranges&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent.print_response(<span class="string">&quot;whats on my list?&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent.print_response(<span class="string">&quot;Clear everything from my list and start over with just bananas and yogurt&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="状态持久化保存"><a href="#状态持久化保存" class="headerlink" title="状态持久化保存"></a>状态持久化保存</h3><p>需要设置<code>storage</code>。</p>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Run `pip install agno openai sqlalchemy` to install dependencies.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"><span class="keyword">from</span> agno.models.openai <span class="keyword">import</span> OpenAIChat</span><br><span class="line"><span class="keyword">from</span> agno.storage.sqlite <span class="keyword">import</span> SqliteStorage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a tool that adds an item to the shopping list</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">agent: Agent, item: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add an item to the shopping list.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">not</span> <span class="keyword">in</span> agent.session_state[<span class="string">&quot;shopping_list&quot;</span>]:</span><br><span class="line">        agent.session_state[<span class="string">&quot;shopping_list&quot;</span>].append(item)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;The shopping list is now <span class="subst">&#123;agent.session_state[<span class="string">&#x27;shopping_list&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">agent = Agent(</span><br><span class="line">    model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4o-mini&quot;</span>),</span><br><span class="line">    <span class="comment"># Fix the session id to continue the same session across execution cycles</span></span><br><span class="line">    session_id=<span class="string">&quot;fixed_id_for_demo&quot;</span>,</span><br><span class="line">    <span class="comment"># Initialize the session state with an empty shopping list</span></span><br><span class="line">    session_state=&#123;<span class="string">&quot;shopping_list&quot;</span>: []&#125;,</span><br><span class="line">    <span class="comment"># Add a tool that adds an item to the shopping list</span></span><br><span class="line">    tools=[add_item],</span><br><span class="line">    <span class="comment"># Store the session state in a SQLite database</span></span><br><span class="line">    storage=SqliteStorage(table_name=<span class="string">&quot;agent_sessions&quot;</span>, db_file=<span class="string">&quot;tmp/data.db&quot;</span>),</span><br><span class="line">    <span class="comment"># Add the current shopping list from the state in the instructions</span></span><br><span class="line">    instructions=<span class="string">&quot;Current shopping list is: &#123;shopping_list&#125;&quot;</span>,</span><br><span class="line">    <span class="comment"># Important: Set `add_state_in_messages=True`</span></span><br><span class="line">    <span class="comment"># to make `&#123;shopping_list&#125;` available in the instructions</span></span><br><span class="line">    add_state_in_messages=<span class="literal">True</span>,</span><br><span class="line">    markdown=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">agent.print_response(<span class="string">&quot;What&#x27;s on my shopping list?&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br><span class="line">agent.print_response(<span class="string">&quot;Add milk, eggs, and bread&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Session state: <span class="subst">&#123;agent.session_state&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h2><p>Agno 提供三种 <code>memory</code>：</p>
<ol>
<li><code>Session Storage (chat history and session state)</code>：将 Agent 的会话以及<code>session_state</code>保存在数据库中，并使 Agent 能够进行多轮对话。</li>
<li><code>User Memories (user preferences)</code>：Agent 可以存储它通过对话了解到的有关用户的见解和事实。</li>
<li><code>Session Summaries (chat summary)</code>：Agent 可以存储会话的压缩表示形式，在聊天历史记录过长时非常有用。</li>
</ol>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"><span class="keyword">from</span> agno.memory.v2.db.sqlite <span class="keyword">import</span> SqliteMemoryDb</span><br><span class="line"><span class="keyword">from</span> agno.memory.v2.memory <span class="keyword">import</span> Memory</span><br><span class="line"><span class="keyword">from</span> agno.models.openai <span class="keyword">import</span> OpenAIChat</span><br><span class="line"><span class="keyword">from</span> agno.storage.sqlite <span class="keyword">import</span> SqliteStorage</span><br><span class="line"><span class="keyword">from</span> rich.pretty <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserId for the memories</span></span><br><span class="line">user_id = <span class="string">&quot;ava&quot;</span></span><br><span class="line"><span class="comment"># Database file for memory and storage</span></span><br><span class="line">db_file = <span class="string">&quot;tmp/agent.db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize memory.v2</span></span><br><span class="line">memory = Memory(</span><br><span class="line">    <span class="comment"># Use any model for creating memories</span></span><br><span class="line">    model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4.1&quot;</span>),</span><br><span class="line">    db=SqliteMemoryDb(table_name=<span class="string">&quot;user_memories&quot;</span>, db_file=db_file),</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Initialize storage</span></span><br><span class="line">storage = SqliteStorage(table_name=<span class="string">&quot;agent_sessions&quot;</span>, db_file=db_file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize Agent</span></span><br><span class="line">memory_agent = Agent(</span><br><span class="line">    model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4.1&quot;</span>),</span><br><span class="line">    <span class="comment"># Store memories in a database</span></span><br><span class="line">    memory=memory,</span><br><span class="line">    <span class="comment"># Give the Agent the ability to update memories</span></span><br><span class="line">    enable_agentic_memory=<span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># OR - Run the MemoryManager after each response</span></span><br><span class="line">    enable_user_memories=<span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># Store the chat history in the database</span></span><br><span class="line">    storage=storage,</span><br><span class="line">    <span class="comment"># Add the chat history to the messages</span></span><br><span class="line">    add_history_to_messages=<span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># Number of history runs</span></span><br><span class="line">    num_history_runs=<span class="number">3</span>,</span><br><span class="line">    markdown=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">memory.clear()</span><br><span class="line">memory_agent.print_response(</span><br><span class="line">    <span class="string">&quot;My name is Ava and I like to ski.&quot;</span>,</span><br><span class="line">    user_id=user_id,</span><br><span class="line">    stream=<span class="literal">True</span>,</span><br><span class="line">    stream_intermediate_steps=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Memories about Ava:&quot;</span>)</span><br><span class="line">pprint(memory.get_user_memories(user_id=user_id))</span><br><span class="line"></span><br><span class="line">memory_agent.print_response(</span><br><span class="line">    <span class="string">&quot;I live in san francisco, where should i move within a 4 hour drive?&quot;</span>,</span><br><span class="line">    user_id=user_id,</span><br><span class="line">    stream=<span class="literal">True</span>,</span><br><span class="line">    stream_intermediate_steps=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Memories about Ava:&quot;</span>)</span><br><span class="line">pprint(memory.get_user_memories(user_id=user_id))</span><br></pre></td></tr></table></figure>

<h3 id="会话总结"><a href="#会话总结" class="headerlink" title="会话总结"></a>会话总结</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line">    <span class="keyword">from</span> agno.memory.v2.db.sqlite <span class="keyword">import</span> SqliteMemoryDb</span><br><span class="line">    <span class="keyword">from</span> agno.memory.v2.memory <span class="keyword">import</span> Memory</span><br><span class="line">    <span class="keyword">from</span> agno.models.google.gemini <span class="keyword">import</span> Gemini</span><br><span class="line"></span><br><span class="line">    memory_db = SqliteMemoryDb(table_name=<span class="string">&quot;memory&quot;</span>, db_file=<span class="string">&quot;tmp/memory.db&quot;</span>)</span><br><span class="line">    memory = Memory(db=memory_db)</span><br><span class="line"></span><br><span class="line">    user_id = <span class="string">&quot;jon_hamm@example.com&quot;</span></span><br><span class="line">    session_id = <span class="string">&quot;1001&quot;</span></span><br><span class="line"></span><br><span class="line">    agent = Agent(</span><br><span class="line">        model=Gemini(<span class="built_in">id</span>=<span class="string">&quot;gemini-2.0-flash-exp&quot;</span>),</span><br><span class="line">        memory=memory,</span><br><span class="line">        enable_session_summaries=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    agent.print_response(</span><br><span class="line">        <span class="string">&quot;What can you tell me about quantum computing?&quot;</span>,</span><br><span class="line">        stream=<span class="literal">True</span>,</span><br><span class="line">        user_id=user_id,</span><br><span class="line">        session_id=session_id,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    agent.print_response(</span><br><span class="line">        <span class="string">&quot;I would also like to know about LLMs?&quot;</span>,</span><br><span class="line">        stream=<span class="literal">True</span>,</span><br><span class="line">        user_id=user_id,</span><br><span class="line">        session_id=session_id</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    session_summary = memory.get_session_summary(</span><br><span class="line">        user_id=user_id, session_id=session_id</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Session summary: <span class="subst">&#123;session_summary.summary&#125;</span>\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><p>使用：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"></span><br><span class="line">agent = Agent(</span><br><span class="line">    <span class="comment"># Add functions or Toolkits</span></span><br><span class="line">    tools=[...],</span><br><span class="line">    <span class="comment"># Show tool calls in the Agent response</span></span><br><span class="line">    show_tool_calls=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="使用已有-toolkit"><a href="#使用已有-toolkit" class="headerlink" title="使用已有 toolkit"></a>使用已有 toolkit</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"><span class="keyword">from</span> agno.tools.duckduckgo <span class="keyword">import</span> DuckDuckGoTools</span><br><span class="line"></span><br><span class="line">agent = Agent(tools=[DuckDuckGoTools()], show_tool_calls=<span class="literal">True</span>, markdown=<span class="literal">True</span>)</span><br><span class="line">agent.print_response(<span class="string">&quot;Whats happening in France?&quot;</span>, stream=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="自定义-Tools"><a href="#自定义-Tools" class="headerlink" title="自定义 Tools"></a>自定义 Tools</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_top_hackernews_stories</span>(<span class="params">num_stories: <span class="built_in">int</span> = <span class="number">10</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Use this function to get top stories from Hacker News.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        num_stories (int): Number of stories to return. Defaults to 10.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        str: JSON string of top stories.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fetch top story IDs</span></span><br><span class="line">    response = httpx.get(<span class="string">&#x27;https://hacker-news.firebaseio.com/v0/topstories.json&#x27;</span>)</span><br><span class="line">    story_ids = response.json()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fetch story details</span></span><br><span class="line">    stories = []</span><br><span class="line">    <span class="keyword">for</span> story_id <span class="keyword">in</span> story_ids[:num_stories]:</span><br><span class="line">        story_response = httpx.get(<span class="string">f&#x27;https://hacker-news.firebaseio.com/v0/item/<span class="subst">&#123;story_id&#125;</span>.json&#x27;</span>)</span><br><span class="line">        story = story_response.json()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;text&quot;</span> <span class="keyword">in</span> story:</span><br><span class="line">            story.pop(<span class="string">&quot;text&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">        stories.append(story)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(stories)</span><br><span class="line"></span><br><span class="line">agent = Agent(tools=[get_top_hackernews_stories], show_tool_calls=<span class="literal">True</span>, markdown=<span class="literal">True</span>)</span><br><span class="line">agent.print_response(<span class="string">&quot;Summarize the top 5 stories on hackernews?&quot;</span>, stream=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h2 id="结构化输出-1"><a href="#结构化输出-1" class="headerlink" title="结构化输出"></a>结构化输出</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> rich.pretty <span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">from</span> agno.agent <span class="keyword">import</span> Agent, RunResponse</span><br><span class="line"><span class="keyword">from</span> agno.models.openai <span class="keyword">import</span> OpenAIChat</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovieScript</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    setting: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Provide a nice setting for a blockbuster movie.&quot;</span>)</span><br><span class="line">    ending: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Ending of the movie. If not available, provide a happy ending.&quot;</span>)</span><br><span class="line">    genre: <span class="built_in">str</span> = Field(</span><br><span class="line">        ..., description=<span class="string">&quot;Genre of the movie. If not available, select action, thriller or romantic comedy.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    name: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Give a name to this movie&quot;</span>)</span><br><span class="line">    characters: <span class="type">List</span>[<span class="built_in">str</span>] = Field(..., description=<span class="string">&quot;Name of characters for this movie.&quot;</span>)</span><br><span class="line">    storyline: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;3 sentence storyline for the movie. Make it exciting!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Agent that uses JSON mode</span></span><br><span class="line">json_mode_agent = Agent(</span><br><span class="line">    model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4o&quot;</span>),</span><br><span class="line">    description=<span class="string">&quot;You write movie scripts.&quot;</span>,</span><br><span class="line">    response_model=MovieScript,</span><br><span class="line">    use_json_mode=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">json_mode_agent.print_response(<span class="string">&quot;New York&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Agent that uses structured outputs</span></span><br><span class="line">structured_output_agent = Agent(</span><br><span class="line">    model=OpenAIChat(<span class="built_in">id</span>=<span class="string">&quot;gpt-4o&quot;</span>),</span><br><span class="line">    description=<span class="string">&quot;You write movie scripts.&quot;</span>,</span><br><span class="line">    response_model=MovieScript,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">structured_output_agent.print_response(<span class="string">&quot;New York&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="FastAPI"><a href="#FastAPI" class="headerlink" title="FastAPI"></a>FastAPI</h1><p><em>FastAPI 是一个用于构建 API 的现代、快速（高性能）的 web 框架，专为在 Python 中构建 RESTful API 而设计。</em></p>
<h2 id="FastAPI-基本路由"><a href="#FastAPI-基本路由" class="headerlink" title="FastAPI 基本路由"></a>FastAPI 基本路由</h2><p>每个路由都映射到应用程序中的一个函数，用于处理特定的 HTTP 请求，并返回相应的响应。</p>
<h3 id="根路径路由"><a href="#根路径路由" class="headerlink" title="根路径路由"></a>根路径路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;Hello&quot;</span>: <span class="string">&quot;World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>@app.get(&quot;/&quot;)</code>：使用 <code>@app.get</code> 装饰器创建一个处理根路径的路由。</li>
</ul>
<h3 id="路径参数"><a href="#路径参数" class="headerlink" title="路径参数"></a>路径参数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span>, q: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>其中 <code>&#123;item_id&#125;</code> 是路径参数，对应函数参数 <code>item_id</code>。</li>
<li><code>q</code>是查询参数</li>
</ul>
<p>使用浏览器访问 <strong><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/items/5?q=runoob">http://127.0.0.1:8000/items/5?q=runoob</a></strong>，将会看到如下 JSON 响应：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;q&quot;</span><span class="punctuation">:</span> <span class="string">&quot;runoob&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="请求体"><a href="#请求体" class="headerlink" title="请求体"></a>请求体</h3><p>此处使用 Pydantic 模型 Item 定义了一个请求体，更多 Pydantic 介绍参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/fastapi/fastapi-pydantic.html">FastAPI Pydantic 模型</a>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<p>最终返回一个 Pydantic 模型实例，FastAPI 将自动将其转换为 JSON 格式，并作为响应发送给客户端。</p>
<h3 id="请求头和-Cookie"><a href="#请求头和-Cookie" class="headerlink" title="请求头和 Cookie"></a>请求头和 Cookie</h3><p>使用 Header 和 Cookie 类型注解获取请求头和 Cookie 数据。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Header, Cookie</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">user_agent: <span class="built_in">str</span> = Header(<span class="params"><span class="literal">None</span></span>), session_token: <span class="built_in">str</span> = Cookie(<span class="params"><span class="literal">None</span></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;User-Agent&quot;</span>: user_agent, <span class="string">&quot;Session-Token&quot;</span>: session_token&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>使用 <strong>RedirectResponse</strong> 实现重定向。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> RedirectResponse</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/redirect&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redirect</span>():</span><br><span class="line">    <span class="keyword">return</span> RedirectResponse(url=<span class="string">&quot;/items/&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="错误码"><a href="#错误码" class="headerlink" title="错误码"></a>错误码</h3><p>使用 HTTPException 抛出异常，返回自定义的状态码和详细信息。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id == <span class="number">42</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;Item not found&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义响应头"><a href="#自定义响应头" class="headerlink" title="自定义响应头"></a>自定义响应头</h3><p>使用 <strong>JSONResponse</strong> 自定义响应头</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    content = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;X-Custom-Header&quot;</span>: <span class="string">&quot;custom-header-value&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(content=content, headers=headers)</span><br></pre></td></tr></table></figure>

<h3 id="路径操作依赖项"><a href="#路径操作依赖项" class="headerlink" title="路径操作依赖项"></a>路径操作依赖项</h3><p>依赖项是在路由操作函数执行前或后运行的可复用的函数或对象。在 FastAPI 中，依赖项通常用于两个方面：</p>
<ul>
<li><strong>预处理（Before）依赖项：</strong> 在路由操作函数执行前运行，用于预处理输入数据，验证请求等。</li>
<li><strong>后处理（After）依赖项：</strong> 在路由操作函数执行后运行，用于执行一些后处理逻辑，如日志记录、清理等。</li>
</ul>
<h4 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h4><p>在路由操作函数 <strong>read_items</strong> 中，通过传入 Depends(common_parameters)，我们使用了这个依赖项函数，实现了在路由执行前预处理输入数据的功能。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖项函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">common_parameters</span>(<span class="params">q: <span class="built_in">str</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;q&quot;</span>: q, <span class="string">&quot;skip&quot;</span>: skip, <span class="string">&quot;limit&quot;</span>: limit&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由操作函数</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">commons: <span class="built_in">dict</span> = Depends(<span class="params">common_parameters</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> commons</span><br></pre></td></tr></table></figure>

<h4 id="后处理"><a href="#后处理" class="headerlink" title="后处理"></a>后处理</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖项函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">common_parameters</span>(<span class="params">q: <span class="built_in">str</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;q&quot;</span>: q, <span class="string">&quot;skip&quot;</span>: skip, <span class="string">&quot;limit&quot;</span>: limit&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由操作函数</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">commons: <span class="built_in">dict</span> = Depends(<span class="params">common_parameters</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> commons</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后处理函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">after_request</span>():</span><br><span class="line">    <span class="comment"># 这里可以执行一些后处理逻辑，比如记录日志</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 后处理依赖项</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=<span class="built_in">dict</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items_after</span>(<span class="params">request: <span class="built_in">dict</span> = Depends(<span class="params">after_request</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Items returned successfully&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="多个依赖项组合"><a href="#多个依赖项组合" class="headerlink" title="多个依赖项组合"></a>多个依赖项组合</h4><p>以下例子中，<strong>common_parameters</strong> 和 <strong>verify_token</strong> 是两个不同的依赖项函数，<strong>verify_token</strong> 依赖于 <strong>common_parameters</strong>，这种组合依赖项的方式允许我们在路由执行前先验证一些参数，然后在进行身份验证。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖项函数1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">common_parameters</span>(<span class="params">q: <span class="built_in">str</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;q&quot;</span>: q, <span class="string">&quot;skip&quot;</span>: skip, <span class="string">&quot;limit&quot;</span>: limit&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖项函数2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">token: <span class="built_in">str</span> = Depends(<span class="params">common_parameters</span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> token <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;Token required&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由操作函数</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">token: <span class="built_in">dict</span> = Depends(<span class="params">verify_token</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> token</span><br></pre></td></tr></table></figure>



<h2 id="FastAPI-交互式-API-文档"><a href="#FastAPI-交互式-API-文档" class="headerlink" title="FastAPI 交互式 API 文档"></a>FastAPI 交互式 API 文档</h2><p>FastAPI 提供了内置的交互式 API 文档，使开发者能够轻松了解和测试 API 的各个端点。</p>
<p>这个文档是自动生成的，基于 OpenAPI 规范，支持 Swagger UI 和 ReDoc 两种交互式界面。</p>
<p>默认情况下，你可以通过访问 <strong><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/docs">http://127.0.0.1:8000/docs</a></strong> 来打开 Swagger UI 风格的文档：</p>
<p><img src= "/img/spin.svg" data-lazy-src="https://rean-blog-bucket.oss-cn-guangzhou.aliyuncs.com/assets/essay/20250722163914.png"></p>
<p>或者通过 <strong><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/redoc">http://127.0.0.1:8000/redoc</a></strong> 来打开 ReDoc 风格的文档。</p>
<p><img src= "/img/spin.svg" data-lazy-src="https://rean-blog-bucket.oss-cn-guangzhou.aliyuncs.com/assets/essay/20250722163950.png"></p>
<h1 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h1><p>服务端推送（Server-Send Events），也称为消息推送或通知推送，是一种允许应用<strong>服务器主动将信息发送到客户端</strong>的能力。</p>
<table>
<thead>
<tr>
<th>技术</th>
<th>协议</th>
<th>方向性</th>
<th>复杂度</th>
<th>延迟</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>短轮询</td>
<td>HTTP</td>
<td>双向（伪）</td>
<td>低</td>
<td>高</td>
<td>简单状态检测</td>
</tr>
<tr>
<td>长轮询</td>
<td>HTTP</td>
<td>双向（伪）</td>
<td>中</td>
<td>中</td>
<td>即时消息</td>
</tr>
<tr>
<td>WebSocket</td>
<td>WS</td>
<td>全双工</td>
<td>高</td>
<td>低</td>
<td>游戏&#x2F;高频交易</td>
</tr>
<tr>
<td>SSE</td>
<td>HTTP</td>
<td>单向（服务端→客户端）</td>
<td>低</td>
<td>低</td>
<td>实时通知&#x2F;日志流</td>
</tr>
</tbody></table>
<h2 id="SSE的核心优势"><a href="#SSE的核心优势" class="headerlink" title="SSE的核心优势"></a>SSE的核心优势</h2><ul>
<li><strong>协议轻量</strong>：基于标准HTTP协议，无需额外握手</li>
<li><strong>自动重连</strong>：内置断线重连机制（retry字段）</li>
<li><strong>文本友好</strong>：天然支持UTF-8文本数据流</li>
<li><strong>浏览器原生支持</strong>：现代浏览器100%兼容（IE除外）</li>
</ul>
<h2 id="FastAPI-SSE-示例代码"><a href="#FastAPI-SSE-示例代码" class="headerlink" title="FastAPI SSE 示例代码"></a>FastAPI SSE 示例代码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Iterable</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> sse_starlette.sse <span class="keyword">import</span> EventSourceResponse</span><br><span class="line"><span class="keyword">from</span> starlette.responses <span class="keyword">import</span> FileResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_index</span>():</span><br><span class="line">    <span class="keyword">return</span> FileResponse(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">STREAM_DELAY = <span class="number">1</span>  <span class="comment"># second</span></span><br><span class="line">RETRY_TIMEOUT = <span class="number">15000</span>  <span class="comment"># millisecond</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_new_messages</span>() -&gt; Iterable:</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;event&quot;</span>: <span class="string">&quot;new_message&quot;</span>,</span><br><span class="line">            <span class="string">&quot;retry&quot;</span>: RETRY_TIMEOUT,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: json.dumps(</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;test message&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;datetime&quot;</span>: datetime.datetime.now().isoformat(</span><br><span class="line">                        sep=<span class="string">&quot;T&quot;</span>, timespec=<span class="string">&quot;auto&quot;</span></span><br><span class="line">                    ),</span><br><span class="line">                &#125;</span><br><span class="line">            ),</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: uuid.uuid4(),</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">event_generator</span>(<span class="params">request: Request</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">await</span> request.is_disconnected():</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> message <span class="keyword">in</span> get_new_messages():</span><br><span class="line">            <span class="keyword">yield</span> message</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(STREAM_DELAY)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/stream&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">message_stream</span>(<span class="params">request: Request</span>):</span><br><span class="line">    <span class="keyword">return</span> EventSourceResponse(event_generator(request))</span><br></pre></td></tr></table></figure>

<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>Docker 是一个开源的应用容器引擎，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 linux 服务器，也可以实现虚拟化。</p>
<p>容器是完全使用<strong>沙箱</strong>机制，相互之间不会有任何接口（类 IPhone 的 app），并且容器开销极其低。</p>
<h2 id="镜像（Image）与容器（Container）"><a href="#镜像（Image）与容器（Container）" class="headerlink" title="镜像（Image）与容器（Container）"></a>镜像（Image）与容器（Container）</h2><ul>
<li><strong>镜像（Image）</strong>：容器的静态模板，包含了应用程序运行所需的所有依赖和文件。镜像是不可变的。</li>
<li><strong>容器（Container）</strong>：镜像的一个运行实例，具有自己的文件系统、进程、网络等，且是动态的。容器从镜像启动，并在运行时保持可变。</li>
</ul>
<p><img src= "/img/spin.svg" data-lazy-src="https://rean-blog-bucket.oss-cn-guangzhou.aliyuncs.com/assets/essay/20250723160404.png"></p>
<h3 id="镜像仓库（Docker-Registry）"><a href="#镜像仓库（Docker-Registry）" class="headerlink" title="镜像仓库（Docker Registry）"></a>镜像仓库（Docker Registry）</h3><p>镜像仓库 (Docker Registry) 负责存储、管理和分发镜像，并且提供了登录认证能力，建立了仓库的索引。</p>
<p>镜像仓库管理多个 Repository， Repository 通过命名来区分。每个 Repository 包含一个或多个镜像，镜像通过镜像名称和标签来区分。</p>
<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>Dockerfile 是一个文本文件，包含了构建 Docker 镜像的所有指令。</p>
<p>基本结构包括以下几个部分：</p>
<ul>
<li>基础映像（Base Image）：使用 FROM 指令指定基础映像，作为构建镜像的起点。基础映像通常包含了操作系统和一些预装的软件和工具。</li>
<li>构建过程指令：使用一系列指令来描述构建过程，例如 RUN 用于执行命令和安装软件包，COPY 用于拷贝文件和目录，ADD 用于拷贝和提取文件，WORKDIR 用于设置工作目录，等等。</li>
<li>容器启动指令：使用 CMD 或 ENTRYPOINT 指令来定义容器启动时要执行的命令，也就是默认的容器执行命令。</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos7.<span class="number">9.2009</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> akuya&lt;<span class="number">123456</span>@qq.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境以及工作目录</span></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装vim、ipconfig等命令</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install net-tools</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;---akuya---&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>

<h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建镜像命令</span></span><br><span class="line">docker build -f Dockerfile -t mycentos:1.0 .</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li><code>-f</code>：等价于<code>--file</code>，指定 dockerfile 文件</li>
<li><code>-t</code>：等价于<code>--tag</code>，指定输出的镜像文件名:版本号</li>
</ul>
<p><strong>命令最后一定要加一个<code>.</code></strong></p>
<h2 id="容器-vs-虚拟机"><a href="#容器-vs-虚拟机" class="headerlink" title="容器 vs 虚拟机"></a>容器 vs 虚拟机</h2><p>容器时在 linux 上本机运行，并与其他容器共享主机的内核，它运行的是一个<strong>独立的进程</strong>，不占用其他任何可执行文件的内存，非常轻量。</p>
<p>虚拟机运行的是一个完整的操作系统，通过虚拟机管理程序对主机资源进行虚拟访问，相比之下需要的资源更多。</p>
<h2 id="卷（Volume）"><a href="#卷（Volume）" class="headerlink" title="卷（Volume）"></a>卷（Volume）</h2><p>卷是用于持久化数据的文件系统，可以在容器之间共享和重用。通过使用卷，数据可以在容器停止或删除时仍然保留。</p>
<p>使用数据卷的步骤一般分为两步：</p>
<ol>
<li>创建一个数据卷</li>
<li>使用 <code>-v</code> 或 <code>--mount</code> 参数将数据卷挂载容器指定目录中，这样所有该容器针对该指定目录的写操作都会保存在宿主机上的 Volume 中。</li>
</ol>
<h3 id="创建-volume"><a href="#创建-volume" class="headerlink" title="创建 volume"></a>创建 volume</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume create my-vol</span><br></pre></td></tr></table></figure>

<h3 id="查看-volume"><a href="#查看-volume" class="headerlink" title="查看 volume"></a>查看 volume</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker volume <span class="built_in">ls</span></span></span><br><span class="line">local    my-vol</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker volume inspect my-vol</span></span><br><span class="line">[</span><br><span class="line"> &#123;</span><br><span class="line">  &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">  &quot;Labels&quot;: &#123;&#125;,</span><br><span class="line">  &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/my-vol/_data&quot;,</span><br><span class="line">  &quot;Name&quot;: &quot;my-vol&quot;,</span><br><span class="line">  &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">  &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line"> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="删除-volume"><a href="#删除-volume" class="headerlink" title="删除 volume"></a>删除 volume</h3><p>删除一个 Volume：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume rm my-vol</span><br></pre></td></tr></table></figure>

<p>删除所有未使用的 Volumes：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure>

<h3 id="挂载数据卷到容器目录"><a href="#挂载数据卷到容器目录" class="headerlink" title="挂载数据卷到容器目录"></a>挂载数据卷到容器目录</h3><p>使用<code>--mount</code>参数：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d \</span></span><br><span class="line"><span class="language-bash"> --name=nginxtest \</span></span><br><span class="line"><span class="language-bash"> --mount <span class="built_in">source</span>=nginx-vol,destination=/usr/share/nginx/html \</span></span><br><span class="line"><span class="language-bash"> nginx:latest</span></span><br></pre></td></tr></table></figure>

<p><code>source</code> 指定 <code>volume</code>，<code>destination</code> 指定容器内的文件或文件夹。</p>
<p>使用 -v 参数：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d \</span></span><br><span class="line"><span class="language-bash"> --name=nginxtest \</span></span><br><span class="line"><span class="language-bash"> -v nginx-vol:/usr/share/nginx/html \</span></span><br><span class="line"><span class="language-bash"> nginx:latest</span></span><br></pre></td></tr></table></figure>

<p><code>-v</code> 参数使用冒号分割 <code>source</code> 和 <code>destination</code>，冒号前半部分是 <code>source</code>，后半部分是 <code>destination</code>。</p>
<p>挂载成功后，容器从 <strong>&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</strong> 目录下读取或写入数据，实际上都是从宿主机的 nginx-vol 数据卷中读取或写入数据。因此 Volumes 或 Bind mounts 也可以看作是容器和宿主机共享文件的一种方式。</p>
<h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li><strong><code>-d</code></strong>: 后台运行容器并返回容器 ID。</li>
<li><strong><code>-it</code></strong>: 交互式运行容器，分配一个伪终端。</li>
<li><strong><code>--name</code></strong>: 给容器指定一个名称。<code>docker run --name my_container ubuntu</code>即运行一个 ubuntu 容器，并将其命名为 my_container。</li>
<li><strong><code>-p</code></strong>: 端口映射，格式为 <code>host_port:container_port</code>。<code>docker run -p 8080:80 nginx</code>即将本地主机的 8080 端口映射到容器内的 80 端口，运行 nginx 容器。</li>
<li><strong><code>-v</code></strong>: 挂载卷，格式为 <code>host_dir:container_dir</code>。</li>
<li><strong><code>--rm</code></strong>: 容器停止后自动删除容器。</li>
<li><strong><code>--env</code> 或 <code>-e</code></strong>: 设置环境变量。</li>
<li><strong><code>--network</code></strong>: 指定容器的网络模式。</li>
<li><strong><code>--restart</code></strong>: 容器的重启策略（如 <code>no</code>、<code>on-failure</code>、<code>always</code>、<code>unless-stopped</code>）。</li>
<li><strong><code>-u</code></strong>: 指定用户。</li>
</ul>
<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><p>Docker Compose 是一个用于<strong>定义和运行多容器 Docker 应用</strong>的工具。通过一个 YAML 文件（<code>docker-compose.yml</code>）可以配置应用程序的所有服务，然后使用单个命令创建和启动所有服务。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><div class="note  flat warning"><p>在安装 Docker Compose 前，请确保已安装 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/">Docker Engine</a></p>
</div>

<h4 id="Linux-安装方法"><a href="#Linux-安装方法" class="headerlink" title="Linux 安装方法"></a>Linux 安装方法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载最新版本的 Docker Compose</span></span><br><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/v2.23.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加可执行权限</span></span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证安装</span></span><br><span class="line">docker-compose --version</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">应输出：Docker Compose version v2.23.0</span></span><br></pre></td></tr></table></figure>

<h4 id="Windows-macOS-安装"><a href="#Windows-macOS-安装" class="headerlink" title="Windows&#x2F;macOS 安装"></a>Windows&#x2F;macOS 安装</h4><p>Windows 和 macOS 的 Docker Desktop 已包含 Docker Compose，无需单独安装。</p>
<h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ol>
<li>**服务 (Service)**：一个容器化的应用（如 web 服务器、数据库）</li>
<li>**项目 (Project)**：由一组关联服务组成的完整应用</li>
<li><strong>Compose 文件</strong>：定义服务、网络和卷的 YAML 文件</li>
</ol>
<h3 id="docker-compose-yml-文件结构"><a href="#docker-compose-yml-文件结构" class="headerlink" title="docker-compose.yml 文件结构"></a>docker-compose.yml 文件结构</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span>  <span class="comment"># Compose 文件格式版本</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span>        <span class="comment"># 定义所有服务</span></span><br><span class="line">  <span class="attr">web:</span>           <span class="comment"># 服务名称</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span>  <span class="comment"># 使用的镜像</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span>  <span class="comment"># 端口映射</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./html:/usr/share/nginx/html</span>  <span class="comment"># 卷挂载</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:15</span></span><br><span class="line">    <span class="attr">environment:</span>  <span class="comment"># 环境变量</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">example</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span>         <span class="comment"># 定义卷</span></span><br><span class="line">  <span class="attr">db-data:</span>       <span class="comment"># 卷名称</span></span><br></pre></td></tr></table></figure>

<h4 id="关键字段"><a href="#关键字段" class="headerlink" title="关键字段"></a>关键字段</h4><table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">说明</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>version</code></td>
<td align="left">Compose 文件版本</td>
<td align="left"><code>&quot;3.9&quot;</code></td>
</tr>
<tr>
<td align="left"><code>services</code></td>
<td align="left">定义所有服务</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>image</code></td>
<td align="left">使用的 Docker 镜像</td>
<td align="left"><code>nginx:alpine</code></td>
</tr>
<tr>
<td align="left"><code>build</code></td>
<td align="left">根据 Dockerfile 构建镜像</td>
<td align="left"><code>context: ./dir</code></td>
</tr>
<tr>
<td align="left"><code>ports</code></td>
<td align="left">端口映射</td>
<td align="left"><code>- &quot;8080:80&quot;</code></td>
</tr>
<tr>
<td align="left"><code>volumes</code></td>
<td align="left">卷挂载</td>
<td align="left"><code>- ./data:/app/data</code></td>
</tr>
<tr>
<td align="left"><code>environment</code></td>
<td align="left">设置环境变量</td>
<td align="left"><code>DEBUG: &quot;true&quot;</code></td>
</tr>
<tr>
<td align="left"><code>depends_on</code></td>
<td align="left">服务依赖关系</td>
<td align="left"><code>- db</code></td>
</tr>
<tr>
<td align="left"><code>networks</code></td>
<td align="left">加入的网络</td>
<td align="left"><code>- backend</code></td>
</tr>
</tbody></table>
<p>启动应用：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>docker-compose up</code></td>
<td align="left">创建并启动所有服务</td>
</tr>
<tr>
<td align="left"><code>docker-compose up -d</code></td>
<td align="left">在后台运行服务</td>
</tr>
<tr>
<td align="left"><code>docker-compose down</code></td>
<td align="left">停止并移除所有容器、网络</td>
</tr>
<tr>
<td align="left"><code>docker-compose ps</code></td>
<td align="left">查看运行中的服务</td>
</tr>
<tr>
<td align="left"><code>docker-compose logs</code></td>
<td align="left">查看服务日志</td>
</tr>
<tr>
<td align="left"><code>docker-compose logs -f web</code></td>
<td align="left">实时查看 web 服务日志</td>
</tr>
<tr>
<td align="left"><code>docker-compose build</code></td>
<td align="left">构建或重新构建服务镜像</td>
</tr>
<tr>
<td align="left"><code>docker-compose start</code></td>
<td align="left">启动已存在的服务</td>
</tr>
<tr>
<td align="left"><code>docker-compose stop</code></td>
<td align="left">停止运行中的服务</td>
</tr>
<tr>
<td align="left"><code>docker-compose restart</code></td>
<td align="left">重启服务</td>
</tr>
<tr>
<td align="left"><code>docker-compose exec web sh</code></td>
<td align="left">进入 web 服务的容器</td>
</tr>
<tr>
<td align="left"><code>docker-compose pull</code></td>
<td align="left">拉取服务的最新镜像</td>
</tr>
<tr>
<td align="left"><code>docker-compose config</code></td>
<td align="left">验证 Compose 文件格式</td>
</tr>
</tbody></table>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/681665911">【Docker】Docker Registry(镜像仓库) - 知乎</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/468642439">Docker 数据存储之 Volumes 详解 - 知乎</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43980547/article/details/136914370">docker入门（八）—— dockerfile详细介绍，编写dockerfile-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-build-command.html">Docker build 命令 | 菜鸟教程</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-run-command.html">Docker run 命令 | 菜鸟教程</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/YorkZach/p/18984794">Docker Compose 教程：安装、使用与快速入门 - 锋露 - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Natsuago/article/details/145588600">一篇就够！Windows上Docker Desktop安装 + 汉化完整指南（包含解决wsl更新失败方案）_docker汉化-CSDN博客</a></p>
</article><div class="post-copyright"><div class="post-copyright__author_group"><a class="post-copyright__author_img" href="/about/"><img class="post-copyright__author_img_front" src= "/img/spin.svg" data-lazy-src="/img/avatar.jpg"></a><div class="post-copyright__author_name">Rean's Blog</div><div class="post-copyright__author_desc">Enjoy technology and music</div></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div id="quit-box" onclick="RemoveRewardMask()"></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本文是原创文章，采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>协议，完整转载请注明来自<a href="/">Rean's Blog</a></span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__tag-list"></div></div></div><nav class="needEndHide pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/p/f2766b22/"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【综述】LLM - Large Language Model</div></div></a></div><div class="next-post pull-right"><a href="/p/d2c104ef/"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【星尘Infinity/未抒】逆光（Cover：周深/陈楚生）【Synthesizer V Cover】</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><div class="author-info__top-group"><div class="author-info__sayhi" id="author-info__sayhi" onclick="sco.changeSayHelloText()">sayhello.morning</div></div></div><div class="avatar-img-group"><img class="avatar-img" alt="头像" src= "/img/spin.svg" data-lazy-src="/img/avatar.jpg"><div class="avatar-sticker"><img class="avatar-sticker-img" src= "/img/spin.svg" data-lazy-src="https://7.isyangs.cn/34/65f2e4e0423cc-34.png" alt="心情贴纸"></div></div><div class="author-info__description_group"><div class="author-info__description">分享自己对编程的<b>热爱</b>，对知识海洋<b>探索历程</b>，随机掉落<b>无参配布</b>以及<b>翻调</b>（主要是音综类，在B站因为版权基本过不了审（。</div><div class="author-info__description2">相信你可以在这里找到对你有用的知识和教程。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about/"><div class="author-info__name">Rean</div><div class="author-info__desc">Enjoy technology and music</div></a><div class="card-info-social-icons is-center"><a class="social-icon" target="_blank" rel="noopener" href="https://github.com/Rean-Schwarze" title="Github"><i class="solitude  st-github-line"></i></a><a class="social-icon" target="_blank" rel="noopener" href="https://space.bilibili.com/6531436" title="Bilibili"><i class="solitude  st-bilibili-line"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="solitude st-menu-line"></i><span>文章目录</span></div><div class="toc-content" id="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#LLM-API"><span class="toc-text">LLM API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LLM-API-%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">LLM API 请求体参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-text">结构化输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84-Schema"><span class="toc-text">支持的 Schema</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-text">支持的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#string"><span class="toc-text">string</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#number"><span class="toc-text">number</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#array"><span class="toc-text">array</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Json-%E6%A8%A1%E5%BC%8F"><span class="toc-text">Json 模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Tools"><span class="toc-text">使用 Tools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E7%9A%84-Tools"><span class="toc-text">可用的 Tools</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-text">函数调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="toc-text">函数定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E5%BC%8F%E5%93%8D%E5%BA%94"><span class="toc-text">流式响应</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Agent-Agno"><span class="toc-text">Agent - Agno</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Agent-%E5%88%9B%E5%BB%BA"><span class="toc-text">Agent 创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenAI-Like-%E6%A8%A1%E5%9E%8B"><span class="toc-text">OpenAI Like 模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-Agent"><span class="toc-text">运行 Agent</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agent-State"><span class="toc-text">Agent State</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E5%AF%B9%E8%AF%9D%E4%BF%9D%E6%8C%81%E7%8A%B6%E6%80%81"><span class="toc-text">跨对话保持状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E5%AD%98"><span class="toc-text">状态持久化保存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Memory"><span class="toc-text">Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E6%80%BB%E7%BB%93"><span class="toc-text">会话总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tools"><span class="toc-text">Tools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%B2%E6%9C%89-toolkit"><span class="toc-text">使用已有 toolkit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Tools"><span class="toc-text">自定义 Tools</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA-1"><span class="toc-text">结构化输出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FastAPI"><span class="toc-text">FastAPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FastAPI-%E5%9F%BA%E6%9C%AC%E8%B7%AF%E7%94%B1"><span class="toc-text">FastAPI 基本路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E8%B7%AF%E5%BE%84%E8%B7%AF%E7%94%B1"><span class="toc-text">根路径路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-text">路径参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-text">请求体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%92%8C-Cookie"><span class="toc-text">请求头和 Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-text">重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E7%A0%81"><span class="toc-text">错误码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-text">自定义响应头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-text">路径操作依赖项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-text">预处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E5%A4%84%E7%90%86"><span class="toc-text">后处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E4%BE%9D%E8%B5%96%E9%A1%B9%E7%BB%84%E5%90%88"><span class="toc-text">多个依赖项组合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FastAPI-%E4%BA%A4%E4%BA%92%E5%BC%8F-API-%E6%96%87%E6%A1%A3"><span class="toc-text">FastAPI 交互式 API 文档</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSE"><span class="toc-text">SSE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSE%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="toc-text">SSE的核心优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FastAPI-SSE-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-text">FastAPI SSE 示例代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker"><span class="toc-text">Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%EF%BC%88Image%EF%BC%89%E4%B8%8E%E5%AE%B9%E5%99%A8%EF%BC%88Container%EF%BC%89"><span class="toc-text">镜像（Image）与容器（Container）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%EF%BC%88Docker-Registry%EF%BC%89"><span class="toc-text">镜像仓库（Docker Registry）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile"><span class="toc-text">Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-text">示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-text">构建镜像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8-vs-%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text">容器 vs 虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B7%EF%BC%88Volume%EF%BC%89"><span class="toc-text">卷（Volume）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-volume"><span class="toc-text">创建 volume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-volume"><span class="toc-text">查看 volume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-volume"><span class="toc-text">删除 volume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%88%B0%E5%AE%B9%E5%99%A8%E7%9B%AE%E5%BD%95"><span class="toc-text">挂载数据卷到容器目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-text">启动容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Compose"><span class="toc-text">Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95"><span class="toc-text">Linux 安装方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows-macOS-%E5%AE%89%E8%A3%85"><span class="toc-text">Windows&#x2F;macOS 安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-compose-yml-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">docker-compose.yml 文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E6%AE%B5"><span class="toc-text">关键字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">常用命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-text">参考链接</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="solitude st-map-line"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/p/f2766b22/" title="【综述】LLM - Large Language Model"><img alt="【综述】LLM - Large Language Model" src= "/img/spin.svg" data-lazy-src="https://npm.elemecdn.com/justlovesmile-photo/221228-15574975489aa1.jpg"></a><div class="content"><a class="title" href="/p/f2766b22/" title="【综述】LLM - Large Language Model">【综述】LLM - Large Language Model</a><a class="article-recent_post_categories" href="/p/f2766b22/">学习</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/694e526e/" title="【Notes】LLM API+Agent+FastAPI+SSE+Docker"><img alt="【Notes】LLM API+Agent+FastAPI+SSE+Docker" src= "/img/spin.svg" data-lazy-src="https://npm.elemecdn.com/justlovesmile-photo/cover8.JPG"></a><div class="content"><a class="title" href="/p/694e526e/" title="【Notes】LLM API+Agent+FastAPI+SSE+Docker">【Notes】LLM API+Agent+FastAPI+SSE+Docker</a><a class="article-recent_post_categories" href="/p/694e526e/">学习</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/d2c104ef/" title="【星尘Infinity/未抒】逆光（Cover：周深/陈楚生）【Synthesizer V Cover】"><img alt="【星尘Infinity/未抒】逆光（Cover：周深/陈楚生）【Synthesizer V Cover】" src= "/img/spin.svg" data-lazy-src="https://rean-song-bucket.oss-cn-guangzhou.aliyuncs.com/assets/cover/逆光_cover.png"></a><div class="content"><a class="title" href="/p/d2c104ef/" title="【星尘Infinity/未抒】逆光（Cover：周深/陈楚生）【Synthesizer V Cover】">【星尘Infinity/未抒】逆光（Cover：周深/陈楚生）【Synthesizer V Cover】</a><a class="article-recent_post_categories" href="/p/d2c104ef/">VOCALOID·UTAU</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/401d6e5a/" title="【永夜Minus】珠玉 (live)（Cover：单依纯）【歌手2025】【Synthesizer V Cover】"><img alt="【永夜Minus】珠玉 (live)（Cover：单依纯）【歌手2025】【Synthesizer V Cover】" src= "/img/spin.svg" data-lazy-src="https://rean-song-bucket.oss-cn-guangzhou.aliyuncs.com/assets/cover/珠玉_cover.jpg"></a><div class="content"><a class="title" href="/p/401d6e5a/" title="【永夜Minus】珠玉 (live)（Cover：单依纯）【歌手2025】【Synthesizer V Cover】">【永夜Minus】珠玉 (live)（Cover：单依纯）【歌手2025】【Synthesizer V Cover】</a><a class="article-recent_post_categories" href="/p/401d6e5a/">VOCALOID·UTAU</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/197094e3/" title="【墨清弦AI】唯一（Cover：G.E.M.邓紫棋）【ACE Cover】"><img alt="【墨清弦AI】唯一（Cover：G.E.M.邓紫棋）【ACE Cover】" src= "/img/spin.svg" data-lazy-src="https://rean-song-bucket.oss-cn-guangzhou.aliyuncs.com/assets/cover/唯一_cover.png"></a><div class="content"><a class="title" href="/p/197094e3/" title="【墨清弦AI】唯一（Cover：G.E.M.邓紫棋）【ACE Cover】">【墨清弦AI】唯一（Cover：G.E.M.邓紫棋）【ACE Cover】</a><a class="article-recent_post_categories" href="/p/197094e3/">VOCALOID·UTAU</a></div></div></div></div></div></div></main><footer id="footer"><div id="st-footer-bar"><div class="footer-logo"><span class="solitude">Rean's Blog</span></div><div class="footer-bar-description">来自Rean's Blog - Enjoy technology and music的文章</div><a class="footer-bar-link" href="/">了解更多</a></div><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/Rean-Schwarze" title="Github"><i class="solitude  st-github-line"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/6531436" title="Bilibili"><i class="solitude  st-bilibili-line"></i></a></div><div id="st-footer"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div class="copyright">© 2024 - 2025 By&nbsp;<a class="footer-bar-link" href="/">Rean</a></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/valor-x/hexo-theme-solitude" alt="主题">主题</a><a class="footer-bar-link cc" href="/null" aria-label="copyright"><i class="solitude st-copyright-line"></i><i class="solitude st-creative-commons-by-line"></i><i class="solitude st-creative-commons-nc-line"></i><i class="solitude st-creative-commons-nd-line"></i></a></div></div></div></footer></div><!-- right_menu--><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="solitude st-arrow-left-line"></i></div><div class="rightMenu-item" id="menu-forward"><i class="solitude st-arrow-right-line"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="solitude st-restart-line"></i></div><div class="rightMenu-item" id="menu-top"><i class="solitude st-arrow-up-line"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="solitude st-copy-fill"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="solitude st-clipboard-fill"></i><span>粘贴文本</span></div><div class="rightMenu-item" id="menu-newwindow"><i class="solitude st-window-fill"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="solitude st-link-line"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="solitude st-copy-fill"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="solitude st-download-cloud-fill"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-search"><i class="solitude st-search-line"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="solitude st-play-fill"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="solitude st-skip-back-fill"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="solitude st-skip-forward-fill"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="solitude st-copy-fill"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><div class="rightMenu-item" id="menu-randomPost" onclick="toRandomPost()||rm.hideRightMenu()"><i class="solitude st-signal-tower-fill"></i><span>随机短文</span></div><div class="rightMenu-item" onclick="pjax.loadUrl('/categories/')||rm.hideRightMenu()"><i class="solitude st-checkbox-multiple-blank-fill"></i><span>全部分类</span></div><div class="rightMenu-item" onclick="pjax.loadUrl('/tags/')||rm.hideRightMenu()"><i class="solitude st-price-tag-fill"></i><span>全部标签</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><div class="rightMenu-item" id="menu-darkmode" onclick="sco.switchDarkMode()"><i class="solitude st-moon-clear-fill"></i><span class="menu-darkmode-text">深色模式</span></div><div class="rightMenu-item" id="menu-translate"><i class="solitude st-panben-line"></i><span>轉為繁體</span></div></div></div><div id="rightmenu-mask"></div><!-- inject body--><div><script src="/js/utils.js?v=1.8.10"></script><script src="/js/main.js?v=1.8.10"></script><script src="/js/third_party/waterfall.min.js?v=1.8.10"></script><script src="https://cdn.staticfile.net/pjax/0.2.8/pjax.min.js"></script><script src="/js/third_party/universe.min.js?v=1.8.10"></script><script>dark()
</script><script src="/js/tw_cn.js?v=1.8.10"></script><script src="https://cdn.staticfile.net/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><script src="https://cdn.staticfile.net/node-snackbar/0.1.16/snackbar.min.js"></script><script src="https://cdn.staticfile.net/fancyapps-ui/5.0.36/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.staticfile.net/Swiper/11.0.5/swiper-bundle.min.js"></script><script>var meting_api = 'https://meting.qjqq.cn/?server=:server&type=:type&id=:id&auth=:auth&r=:r';</script><script src="https://cdn.staticfile.net/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.staticfile.net/meting/2.0.1/Meting.min.js"></script><script>const coverColorConfig = {
    api: 'https://api.qjqq.cn/api/Imgcolor?img=',
    time: 43200000
}</script><script src="/js/covercolor/api.js?v=1.8.10"></script><script src="/js/music.js?v=1.8.10"></script><script src="https://cdn.staticfile.net/pace/1.2.4/pace.min.js"></script><script src="/js/right_menu.js?v=1.8.10"></script><div class="js-pjax"><script defer pjax src="https://cdn.staticfile.net/pearssauce-busuanzi/1.0.0/bsz.pure.min.js"></script></div></div><!-- newest comment--><!-- pjax--><script>const pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: ['title','#body-wrap','#site-config','meta[name="description"]','.js-pjax','meta[property^="og:"]','#config-diff'],
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
})

document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
})

document.addEventListener('pjax:complete', () => {
    window.refreshFn()

    document.querySelectorAll('script[data-pjax]').forEach(item => {
        const newScript = document.createElement('script')
        const content = item.text || item.textContent || item.innerHTML || ""
        Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
        newScript.appendChild(document.createTextNode(content))
        item.parentNode.replaceChild(newScript, item)
    })

    GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

})

document.addEventListener('pjax:error', (e) => {
    if (e.request.status === 404) {
        pjax.loadUrl('/404.html')
    }
})</script><!-- theme--><script>initTheme = () => {
    let isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const cachedMode = utils.saveToLocal.get('theme');
    if (cachedMode === undefined) {
        const nowMode =
            isDarkMode ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', nowMode);
    } else {
        document.documentElement.setAttribute('data-theme', cachedMode);
    }
    is_rm && rm.mode(cachedMode === 'dark' && isDarkMode)
}
initTheme()</script><!-- google adsense--><!-- search--><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="solitude st-close-fill"></i></button></nav><div class="search-wrap"><div class="search-box"><input class="search-box-input" id="search-input" type="text" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off" placeholder="输入关键词快速查找"></div><div id="search-results"><div id="search-hits"></div></div><div id="search-pagination"></div><div id="search-tips"></div></div></div><div id="search-mask"></div></div><script src="/js/search/local.js?v=1.8.10"></script><!-- music--><div class="needEndHide" id="nav-music" onclick="sco.musicToggle()"><div id="nav-music-hoverTips">音乐已暂停</div><meting-js id="421801417" server="netease" type="playlist" mutex="true" preload="none" data-lrctype="0" order="random" theme="var(--efu-main)"></meting-js></div></body></html><script>const posts=["p/f2766b22/","p/694e526e/","p/d2c104ef/","p/401d6e5a/","p/197094e3/","p/867e546a/","p/9d906c2f/","p/8e8e2cc6/","p/2b6e13f/","p/e7845a78/","p/5871d67/","p/204d99f1/","p/b585efd0/","p/122902e7/","p/683f7c8e/","p/36b252a1/","p/bbd98f0d/","p/1b320550/","p/30cd73ca/","p/332adb42/","p/4f877c1e/","p/677c7789/","p/f7f0a5f3/","p/9b5a538c/","p/37360bc0/","p/bb996d5/","p/364ea8cc/","p/a027699d/","p/21cdaec5/","p/37c37880/","p/a02febe4/","p/d1ec0e4e/","p/25d2b878/","p/8324e4bc/","p/6021f67a/","p/305331f0/","p/66be4b4/","p/de2d10bc/","p/e6628f8e/","p/4131eeff/","p/27705e17/","p/74e1a37c/","p/b5223f80/","p/9b8bc45a/","p/c9cb7159/","p/82c942ab/","p/4c19fcc6/","p/27446c6a/","p/9f38852a/","p/2516f5f2/","p/b27c77b3/","p/7a3264f/","p/7beadfaa/","p/e1d9906f/","p/a440b512/","p/a46aa116/","p/fe8dd3bd/","p/51c99199/","p/91b418a/","p/421add40/","p/9d7a18c7/","p/26345198/","p/fa30e874/","p/dea9a817/","p/59203ba6/","p/e5616c72/","p/971e9859/","p/d7f6ccff/","p/1b2ec1c2/","p/a0d1cef9/","p/a58b6af0/","p/9381aa6d/","p/38b8becb/","p/d0a26095/","p/2b3bdada/","p/ba70636/","p/374630f5/","p/a964a243/","p/a06e9899/","p/ef9a99de/","p/108f7c52/","p/a91c1846/","p/413576cf/","p/9ee60c65/","p/e74db628/","p/888c8bf3/","p/477dbe08/","p/38e8a510/","p/dfb41864/","p/b0e3506b/","p/e17fd725/","p/e1fe458c/","p/636cfdea/","p/7b854cb7/","p/b3a61240/","p/64f43fb4/","p/800f9a11/","p/4a48b34c/","p/b3641215/","p/53bc1fc9/","p/fc02f9ee/","p/25b929f6/","p/dd30b42/","p/3aa261db/","p/fc078742/","p/22c9d1d0/","p/33fc02d2/","p/70335ae0/","p/f32ef110/","p/f756486c/","p/8dd4b91f/","p/a290d941/","p/61a8a4ef/","p/c2d0bb20/","p/9770d71c/","p/41bd2aed/","p/bfebe40b/","p/6b4006e6/","p/b5696360/","p/53ab7115/","p/e6fa9b9/","p/866abf45/","p/b718b92a/","p/d26f4c21/","p/bc5d6bbe/","p/5a18917b/","p/5f2b1e2f/","p/2532a2ee/","p/4337b2c0/","p/e042d029/","p/9b4a91e5/","p/9d8ce868/","p/a69f6a48/","p/f9b9edb2/","p/cbe55d0/","p/156c59d0/","p/d4d6f818/","p/2574cf15/","p/a0efc292/","p/ec2ecf28/","p/85f11265/","p/db95e6f5/","p/a8296e6d/","p/4cc89a71/","p/d0fe2d0f/","p/ffab2f6b/","p/95d9f91e/","p/7f869365/","p/5b246b1b/","p/a9c92fa9/","p/7d49fec0/","p/a9a25fcd/","p/43bb383e/","p/b9aeb4/","p/52eaf228/","p/4be90d2f/","p/ed500d41/","p/dcfbc8e5/","p/240e5e52/","p/18cda1b3/","p/66a6c396/","p/5f33341/","p/f9bef31e/","p/acac46b/","p/a4189438/","p/ae6b0147/","p/4e982f2d/","p/403e0cac/","p/495b9f0f/","p/8e966ab9/","p/f6e1007e/","p/6f562d19/","p/10eac329/","p/cc53cf58/","p/4f2beac6/","p/73e2aa1/","p/c677e75e/","p/3f13b766/","p/cc30f00/","p/807cab5e/","p/5b5991e4/","p/e941ffc/"];function toRandomPost(){ pjax.loadUrl('/'+posts[Math.floor(Math.random()*posts.length)]); }</script>